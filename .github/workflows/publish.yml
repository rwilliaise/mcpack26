name: Deploy modpack
on:
  push:
    tags:
      - 'v*'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Fetch repository
        uses: actions/checkout@v4
      - name: Install dependencies
        shell: bash
        run: |
          curl -sSLo packwiz.zip https://nightly.link/packwiz/packwiz/workflows/go/main/Linux%2064-bit%20x86.zip && \
            unzip packwiz.zip && \
            chmod +x packwiz && \
            sudo mv packwiz /usr/local/bin/ && \
            rm packwiz.zip
      - name: Find and replace versions
        shell: bash
        env:
          tag: ${{ github.ref_name }}
        run: |
          sed -e "s/__VERSION__/$tag/" \
            config/fancymenu/customization/title_screen_layout.txt > config/fancymenu/customization/title_screen_layout.txt
      - name: Remove ignored files
        shell: bash
        run: while read -r entry;do rm -rf ${entry}; done < .packwizignore
      - name: Refresh index
        run: packwiz refresh --build
      - name: Upload pages
        uses: actions/upload-pages-artifact@v3
        with:
          name: github-pages
          path: .
  deploy:
    needs: build
    runs-on: ubuntu-latest
    permissions:
      pages: write
      id-token: write
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - name: Publishing pages
        id: deployment
        uses: actions/deploy-pages@v4
        with:
          artifact_name: github-pages

